<h2 id="-">了解微信小游戏</h2>
<p><a href="https://mp.weixin.qq.com/debug/wxagame/dev/index.html">官方文档</a>有详细的介绍</p>
<h2 id="-">小游戏的文件结构</h2>
<p>####我们以新建一个官方示例说明####</p>
<p><img src="assets/1.png" alt="clipboard.png"></p>
<p>如图 最外层除了readme外 有3个文件</p>
<ul>
<li><code>game.js</code> 程序入口</li>
<li><code>game.json</code>小游戏配置文件</li>
<li><code>project.config.json</code> 项目设置文件</li>
</ul>
<p>具体配置可以查看官方文档，只有这几个文件需要按照文件名格式来写，其他文件的内容和</p>
<p><img src="assets/2.png" alt="clipboard.png"></p>
<p>这个文件是官方示例中用于模拟浏览器环境的适配器，如有需要可以自己写，我们这里沿用这个。</p>
<p>入口文件 game.js</p>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-string">'./js/libs/weapp-adapter'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./js/libs/symbol'</span>

<span class="hljs-keyword">import</span> Main <span class="hljs-keyword">from</span> <span class="hljs-string">'./js/main'</span>

<span class="hljs-keyword">new</span> Main()

</code></pre><p>整个微信小游戏实际上是运行在微信框架中一个原生canvas中，没有浏览器页面环境如document（这就是为什么有一个模拟浏览器环境的适配器），启动时小游戏框架运行game.js，然后在main.js中基本上都是对微信小游戏api的调用及原生canvas的操作了。如果之前使用过原生canvas或者其他canvas库的同学 马上就可以上手开发0成本，官方开发工具也有es6=》es5的转换所以如果项目比较小都不用其他东西，直接文本编辑器修改 保存 查看 即可。</p>
<p><img src="assets/3.png" alt="图片描述"></p>
<h2 id="-">开工</h2>
<ol>
<li>音频使用原来的代码</li>
<li><p>帧定时也使用wx的回调函数</p>
<pre><code>window.requestAnimationFrame(
      this<span class="hljs-selector-class">.TimerHandel</span><span class="hljs-selector-class">.bind</span>(this),
      <span class="hljs-selector-tag">canvas</span>
    )
</code></pre></li>
<li><p>引入一个canvas2d库createjs中的ease 和一个自己写的工具库</p>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-string">'./js/libs/weapp-adapter'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./js/libs/ease'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./js/plugin/Math'</span>

<span class="hljs-keyword">import</span> Main <span class="hljs-keyword">from</span> <span class="hljs-string">'./js/main'</span>
<span class="hljs-built_in">window</span>.main = <span class="hljs-keyword">new</span> Main();

</code></pre></li>
<li><p>保留原来的触摸移动飞机并且新增重力感应移动飞机</p>
<pre><code><span class="hljs-keyword">this</span>.initEvent();
wx.startAccelerometer({ success:<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'开始监听加速计'</span>)}});
wx.onAccelerometerChange(<span class="hljs-function"><span class="hljs-params">(res)</span>=&gt;</span>{
  <span class="hljs-keyword">this</span>.player.speedx = Math.floor(res.x*<span class="hljs-number">100</span>)/<span class="hljs-number">10</span>;
  <span class="hljs-keyword">this</span>.player.speedy = Math.floor(-res.y * <span class="hljs-number">100</span>)/<span class="hljs-number">10</span>;
})
</code></pre></li>
<li><p>其他全部删除 基于create.js库重写；所有子弹继承一个父类</p>
<pre><code><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> Bullet_Super {

    <span class="hljs-keyword">constructor</span>(<span class="hljs-params">cantiner, SHOOT_FRAME = 10,sprite_sheet</span>) {
        <span class="hljs-keyword">this</span>.cantiner = cantiner;
        <span class="hljs-keyword">this</span>.shoot_frame = SHOOT_FRAME;
        <span class="hljs-keyword">this</span>.list = [];
        <span class="hljs-keyword">this</span>.deletelist = [];
        <span class="hljs-keyword">this</span>.y = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.x = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">this</span>.spriteSheet = <span class="hljs-keyword">new</span> createjs.SpriteSheet(sprite_sheet);
    }
    outOfScreen(s, test) {
        <span class="hljs-keyword">if</span> (test) {
            <span class="hljs-keyword">if</span> (s.y &gt; <span class="hljs-built_in">window</span>.innerHeight + <span class="hljs-number">100</span> || s.x &gt; <span class="hljs-built_in">window</span>.innerWidth + <span class="hljs-number">100</span> || s.x &lt; <span class="hljs-number">-100</span>) {
                <span class="hljs-keyword">this</span>.deletelist.push(s);
                s.visible = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    createSprite(anime, option, die_option) {
        <span class="hljs-keyword">let</span> isnew = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">let</span> sprite = <span class="hljs-keyword">this</span>.deletelist.length &gt; <span class="hljs-number">0</span>
            ? (isnew = <span class="hljs-literal">false</span>, <span class="hljs-keyword">this</span>.deletelist.shift())
            : <span class="hljs-keyword">new</span> createjs.Sprite(<span class="hljs-keyword">this</span>.spriteSheet, anime);
        sprite.isdie = <span class="hljs-literal">false</span>;
        sprite.dieing_frame=<span class="hljs-number">0</span>;
        sprite.diecount = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">Object</span>.assign(sprite, option);
        sprite.die = sprite.die || <span class="hljs-function">(<span class="hljs-params">(<span class="hljs-params"></span>) =&gt; {
            sprite.isdie = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">Object</span>.assign(<span class="hljs-params">sprite, die_option</span>);
        }</span>);
        !<span class="hljs-params">isnew</span>
            ? (<span class="hljs-params">sprite.visible = <span class="hljs-literal">true</span>, sprite.gotoAndPlay(<span class="hljs-params">anime</span>)</span>)
            : <span class="hljs-params">this</span>.<span class="hljs-params">cantiner</span>.<span class="hljs-params">addChild</span>(<span class="hljs-params">sprite</span>);
        <span class="hljs-params">this</span>.<span class="hljs-params">list</span>.<span class="hljs-params">push</span>(<span class="hljs-params">sprite</span>);
    }
    <span class="hljs-params">update</span>(<span class="hljs-params">timeFunc, dieFunc, diedFunc, test</span>) {
        <span class="hljs-params">this</span>.<span class="hljs-params">list</span> = <span class="hljs-params">this</span>.<span class="hljs-params">list</span>.<span class="hljs-params">filter</span>(<span class="hljs-params">(<span class="hljs-params">s</span>) =&gt; {
            <span class="hljs-keyword">if</span> (<span class="hljs-params">s.isdie</span>) {
                s.diecount++;
                dieFunc(<span class="hljs-params">s</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-params">s.diecount &gt; (<span class="hljs-params">s.dieing_frame</span>)</span>) {
                    diedFunc(<span class="hljs-params">s</span>);
                    <span class="hljs-keyword">this</span>.deletelist.push(<span class="hljs-params">s</span>);
                    s.visible = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            timeFunc(<span class="hljs-params">s</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.outOfScreen(<span class="hljs-params">s, test</span>);
        }</span>);
    }
}</span>
</code></pre></li>
<li><p>之后就是实现各种弹幕，计分显示等</p>
</li>
</ol>
<p>具体移步github <a href="https://github.com/lichddd/weixin_game_test1">https://github.com/lichddd/weixin_game_test1</a>
b站演示<a href="https://www.bilibili.com/video/av19046982/">https://www.bilibili.com/video/av19046982/</a></p>
